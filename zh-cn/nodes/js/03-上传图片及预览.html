<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>上传图片及预览 | 前端开发</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/my_boke/logo_42x42.png">
    <meta name="description" content="记录前端使用的技术">
    
    <link rel="preload" href="/my_boke/assets/css/0.styles.1dc4f169.css" as="style"><link rel="preload" href="/my_boke/assets/js/app.64921fdb.js" as="script"><link rel="preload" href="/my_boke/assets/js/2.1e45f81f.js" as="script"><link rel="preload" href="/my_boke/assets/js/14.1664cfab.js" as="script"><link rel="prefetch" href="/my_boke/assets/js/10.bfc1846c.js"><link rel="prefetch" href="/my_boke/assets/js/11.682d272d.js"><link rel="prefetch" href="/my_boke/assets/js/12.3c606d74.js"><link rel="prefetch" href="/my_boke/assets/js/13.5364de92.js"><link rel="prefetch" href="/my_boke/assets/js/15.e483b2c3.js"><link rel="prefetch" href="/my_boke/assets/js/16.323f92b7.js"><link rel="prefetch" href="/my_boke/assets/js/17.88499b24.js"><link rel="prefetch" href="/my_boke/assets/js/18.d1b840a2.js"><link rel="prefetch" href="/my_boke/assets/js/19.a022e98a.js"><link rel="prefetch" href="/my_boke/assets/js/20.e0c22ab9.js"><link rel="prefetch" href="/my_boke/assets/js/21.24b8b726.js"><link rel="prefetch" href="/my_boke/assets/js/22.427cd282.js"><link rel="prefetch" href="/my_boke/assets/js/23.c41a1c65.js"><link rel="prefetch" href="/my_boke/assets/js/24.22abea87.js"><link rel="prefetch" href="/my_boke/assets/js/25.81deeaf4.js"><link rel="prefetch" href="/my_boke/assets/js/26.55703bd5.js"><link rel="prefetch" href="/my_boke/assets/js/3.ce0460f8.js"><link rel="prefetch" href="/my_boke/assets/js/4.133d005f.js"><link rel="prefetch" href="/my_boke/assets/js/5.bdbbe150.js"><link rel="prefetch" href="/my_boke/assets/js/6.df535412.js"><link rel="prefetch" href="/my_boke/assets/js/7.8fd82ea2.js"><link rel="prefetch" href="/my_boke/assets/js/8.84fa2730.js"><link rel="prefetch" href="/my_boke/assets/js/9.33b1d9e0.js">
    <link rel="stylesheet" href="/my_boke/assets/css/0.styles.1dc4f169.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my_boke/" class="home-link router-link-active"><img src="/my_boke/logo_42x42.png" alt="前端开发" class="logo"> <span class="site-name can-hide">前端开发</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/other/01-其它笔记.html" class="nav-link">
  随记
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html" class="nav-link">
  JS相关
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/css/01-日常开发CSS样式类.html" class="nav-link">
  CSS相关
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/node/" class="nav-link">
  nodejs相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue全家桶" class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue全家桶" class="mobile-dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/vue2/01-vue源码探究.html" class="nav-link">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/router/" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/vuex/" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/axios/01-Axios笔记.html" class="nav-link">
  axios
</a></li></ul></div></div><div class="nav-item"><a href="/my_boke/zh-cn/webpack.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/my_boke/zh-cn/article/" class="nav-link">
  文章分享
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/other/01-其它笔记.html" class="nav-link">
  随记
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html" class="nav-link">
  JS相关
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/css/01-日常开发CSS样式类.html" class="nav-link">
  CSS相关
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/nodes/node/" class="nav-link">
  nodejs相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue全家桶" class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue全家桶" class="mobile-dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/vue2/01-vue源码探究.html" class="nav-link">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/router/" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/vuex/" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/my_boke/zh-cn/vue/axios/01-Axios笔记.html" class="nav-link">
  axios
</a></li></ul></div></div><div class="nav-item"><a href="/my_boke/zh-cn/webpack.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/my_boke/zh-cn/article/" class="nav-link">
  文章分享
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html" class="sidebar-link">日常开发工具函数</a><ul class="sidebar-sub-headers is-none"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#随机-id-值" class="sidebar-link">随机 ID 值</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#随机-uuid" class="sidebar-link">随机 uuid</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#生成一个范围内的随机数" class="sidebar-link">生成一个范围内的随机数</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#delay-延迟" class="sidebar-link">delay 延迟</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#倒计时" class="sidebar-link">倒计时</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#时间日期格式化" class="sidebar-link">时间日期格式化</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#url-参数-k-v-的序列化及反序列化" class="sidebar-link">url 参数(k-v)的序列化及反序列化</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#判断浏览器-useragent" class="sidebar-link">判断浏览器 UserAgent</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#封装-ajax-请求" class="sidebar-link">封装 ajax 请求</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/01-日常开发工具函数.html#常用验证方法" class="sidebar-link">常用验证方法</a></li></ul></li><li><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html" class="sidebar-link">JavaScript数组</a><ul class="sidebar-sub-headers is-none"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#声明数组" class="sidebar-link">声明数组</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#创建数组" class="sidebar-link">创建数组</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#array-of" class="sidebar-link">Array.of</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#类型检测" class="sidebar-link">类型检测</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#类型转换" class="sidebar-link">类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#字符串" class="sidebar-link">字符串</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#array-from" class="sidebar-link">Array.from</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#展开语法" class="sidebar-link">展开语法</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#展开语法-2" class="sidebar-link">展开语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#数组合并" class="sidebar-link">数组合并</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#函数参数" class="sidebar-link">函数参数</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#节点转换" class="sidebar-link">节点转换</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#解构赋值" class="sidebar-link">解构赋值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#严格模式" class="sidebar-link">严格模式</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#简洁定义" class="sidebar-link">简洁定义</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#默认值" class="sidebar-link">默认值</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#函数参数-2" class="sidebar-link">函数参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#管理元素" class="sidebar-link">管理元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#基本使用-2" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#展开语法-3" class="sidebar-link">展开语法</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#push" class="sidebar-link">push</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#pop" class="sidebar-link">pop</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#unshift" class="sidebar-link">unshift</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#shift" class="sidebar-link">shift</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#fill" class="sidebar-link">fill</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#slice" class="sidebar-link">slice</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#splice" class="sidebar-link">splice</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#清空数组" class="sidebar-link">清空数组</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#合并拆分" class="sidebar-link">合并拆分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#join" class="sidebar-link">join</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#split" class="sidebar-link">split</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#concat" class="sidebar-link">concat</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#cotywidthin" class="sidebar-link">cotyWidthin</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#查找元素" class="sidebar-link">查找元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#indexof" class="sidebar-link">indexOf</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#lastindexof" class="sidebar-link">lastIndexOf</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#includes" class="sidebar-link">includes</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#find" class="sidebar-link">find</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#findindex" class="sidebar-link">findIndex</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#find原理" class="sidebar-link">find原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#数组排序" class="sidebar-link">数组排序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#reverse" class="sidebar-link">reverse</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#sort" class="sidebar-link">sort</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#排序原理" class="sidebar-link">排序原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#循环遍历" class="sidebar-link">循环遍历</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#for" class="sidebar-link">for</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#foreach" class="sidebar-link">forEach</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#for-in" class="sidebar-link">for in</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#for-of" class="sidebar-link">for of</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#迭代器方法" class="sidebar-link">迭代器方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#keys" class="sidebar-link">keys</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#values" class="sidebar-link">values</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#entries" class="sidebar-link">entries</a></li></ul></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#扩展方法" class="sidebar-link">扩展方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#every" class="sidebar-link">every</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#some" class="sidebar-link">some</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#filter" class="sidebar-link">filter</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html#reduce" class="sidebar-link">reduce</a></li></ul></li></ul></li><li><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html" class="active sidebar-link">上传图片及预览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#说明" class="sidebar-link">说明</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#上传图片" class="sidebar-link">上传图片</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#图片预览" class="sidebar-link">图片预览</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#大文件切片上传" class="sidebar-link">大文件切片上传</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#前端代码" class="sidebar-link">前端代码</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/03-上传图片及预览.html#后端代码" class="sidebar-link">后端代码</a></li></ul></li></ul></li><li><a href="/my_boke/zh-cn/nodes/js/04-生成二维码.html" class="sidebar-link">生成二维码</a><ul class="sidebar-sub-headers is-none"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/04-生成二维码.html#说明" class="sidebar-link">说明</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/04-生成二维码.html#绘制二维码-下载二维码" class="sidebar-link">绘制二维码，下载二维码</a></li></ul></li><li><a href="/my_boke/zh-cn/nodes/js/05-上拉加载.html" class="sidebar-link">上拉加载</a><ul class="sidebar-sub-headers is-none"><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/05-上拉加载.html#分析" class="sidebar-link">分析</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/05-上拉加载.html#开始封装-过程" class="sidebar-link">开始封装-过程</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/05-上拉加载.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/my_boke/zh-cn/nodes/js/05-上拉加载.html#总结" class="sidebar-link">总结</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="上传图片及预览"><a href="#上传图片及预览" class="header-anchor">#</a> 上传图片及预览</h1> <h2 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h2> <p>使用技术：原生 js 上传图片的方法</p> <p>原生 js 构造函数：</p> <ol><li>FormData</li> <li>XMLHttpRequest</li> <li>fileReader</li></ol> <h2 id="上传图片"><a href="#上传图片" class="header-anchor">#</a> 上传图片</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileInput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//获取图片</span>
		<span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#fileInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		<span class="token comment">//创建formData对象，并将图片添加到formData中</span>
		<span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
		<span class="token comment">// 利用xhr方式上传</span>
		<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/upload'</span><span class="token punctuation">)</span>
		xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">//文件上传成功</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="图片预览"><a href="#图片预览" class="header-anchor">#</a> 图片预览</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileInput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoImage<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token comment">//获取文件上传控件和预览图片的控件</span>
	<span class="token keyword">var</span> echoImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#echoImage'</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#fileInput'</span><span class="token punctuation">)</span>

	<span class="token comment">//为文件上传控件添加onchanges事件</span>
	fileInput<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建读取文件的对象</span>
		<span class="token keyword">var</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">//读取文件为base64格式</span>
		fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token comment">//文件读取成功</span>
		fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//读取到的文件放入img控件</span>
			echoImage<span class="token punctuation">.</span>src <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="大文件切片上传"><a href="#大文件切片上传" class="header-anchor">#</a> 大文件切片上传</h2> <p>前端上传文件时如果文件很大，上传时会出现各种问题，比如连接超时了，网断了，都会导致上传失败。</p> <p>为了避免上传大文件时上传超时，就需要用到切片上传，工作原理是：我们将大文件切割为小文件，然后将切割的若干小文件上传到服务器端，服务器端接收到被切割的小文件，然后按照一定的顺序将小文件拼接合并成一个大文件。</p> <p>相较于单独上传一个文件而言，大文件上传在前端层面，多了一步切割的步骤，后端多了一步合并的步骤，只有前后端配合才能完成大文件切片上传。</p> <p>**技术包括：**H5（前端使用）和nodejs（后端使用）</p> <h3 id="前端代码"><a href="#前端代码" class="header-anchor">#</a> 前端代码</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>upload<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./uuid.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;file&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;upload&quot;</span><span class="token operator">&gt;</span>上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
        <span class="token keyword">var</span> bytesPerPiece <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// 每个文件切片大小定为1MB .</span>
        <span class="token keyword">var</span> totalPieces<span class="token punctuation">;</span>   <span class="token comment">//切片总数</span>
        <span class="token comment">//发送请求</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#upload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span>
        <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> blob <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 文件唯一标识符号，防止多个用户一起上传文件时切片混乱</span>
            <span class="token keyword">var</span> uuidfolder <span class="token operator">=</span> <span class="token function">uuidv1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 开始切割的位置</span>
            <span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// 切割的结束位置</span>
            <span class="token keyword">var</span> end<span class="token punctuation">;</span>
            <span class="token comment">// 切片的索引</span>
            <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// 回调计数器</span>
            <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// 文件的大小</span>
            <span class="token keyword">var</span> filesize <span class="token operator">=</span> blob<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
            <span class="token comment">// 文件的名称</span>
            <span class="token keyword">var</span> filename <span class="token operator">=</span> blob<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            <span class="token comment">//计算文件切片总数</span>
            totalPieces <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>filesize <span class="token operator">/</span> bytesPerPiece<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 启动while循环对文件切片</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>start <span class="token operator">&lt;</span> filesize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 设置切片的结束位置</span>
                end <span class="token operator">=</span> start <span class="token operator">+</span> bytesPerPiece<span class="token punctuation">;</span>
                <span class="token comment">// 对最后一片数据进行处理（可以省略）</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>end <span class="token operator">&gt;</span> filesize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    end <span class="token operator">=</span> filesize<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 切割文件</span>
                <span class="token keyword">var</span> chunk <span class="token operator">=</span> blob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//切割文件</span>
                <span class="token comment">// 给每一片切片设置名字，名字的值为原始名称加索引，这样做是为了让后端可以按照索引顺序合并图片。</span>
                <span class="token keyword">var</span> sliceIndex<span class="token operator">=</span> blob<span class="token punctuation">.</span>name <span class="token operator">+</span> index<span class="token punctuation">;</span>
                <span class="token comment">// 利用formData来传递数据</span>
                <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> sliceIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;uuidfolder&quot;</span><span class="token punctuation">,</span> uuidfolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;imgorder&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    url<span class="token operator">:</span> <span class="token string">'/upload3'</span><span class="token punctuation">,</span>
                    type<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                    data<span class="token operator">:</span> formData<span class="token punctuation">,</span>
                    processData<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 不处理数据</span>
                    contentType<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 不设置内容类型</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
                    count<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span>totalPieces<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;上传结束,请求拼接接口，将切片信息拼接完整，返回图片url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/merge'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span>uuidfolder<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;上传失败&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> end<span class="token punctuation">;</span>
                index<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>上面的代码启动了一个while循环，在这个循环中，每次截取固定大小的切片，然后用ajax上传到后端服务器，并且会附加一些比较重要的信息，这些信息主要包括：图片的唯一标识符（这里用到了uuid.js来生成唯一的id），切片的索引（为了后端按照切片顺序将切片合并），ajax每次上传完成后都要检查所有切片是否上传完成，全部上传完成后，请求合并接口，这个接口返回合并后的图片的url。</p> <p>前端将切片信息传递到后端，后端用过nodejs接受切片，然后按照索引将切片拼接成完整的文件，这里用到了两个工具包multer和concat-files，前一个是负责接收切片信息，后一个负责合并切片。</p> <p>这里一般的做法是设置两个接口，一个接口负责接收图片的切片信息，将其保存，另外一个接口负责拼接切片信息。这样做的原因是，如果用一个接口来操作的话，每张切片接收完成后都要去检查所有切片是否都接收完成，而只有当所有切片完成才能将切片合并，这样比较耗费服务端的性能。</p> <h3 id="后端代码"><a href="#后端代码" class="header-anchor">#</a> 后端代码</h3> <p>接口处理代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 接收切片信息接口</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload3'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  <span class="token comment">// 接受图片唯一标识符号</span>
    <span class="token keyword">let</span> imgname <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>uuidfolder<span class="token punctuation">;</span>
    <span class="token comment">// 接受切片索引</span>
    <span class="token keyword">let</span> imgorder <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>imgorder<span class="token punctuation">;</span>
    <span class="token comment">// 建立图片存储目录</span>
    <span class="token keyword">let</span> imgpath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'..'</span><span class="token punctuation">,</span><span class="token string">'public/mult'</span><span class="token punctuation">,</span>imgname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断目录是否存在，存在的话直接使用并存储切片，不存在的话就新建。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>imgpath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>imgpath<span class="token punctuation">,</span> imgorder<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;写入后面的文件&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>imgpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>imgpath<span class="token punctuation">,</span> imgorder<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;第一次写入并新建文件夹&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 合并图片接口：</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/merge'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">let</span> folderpath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span><span class="token string">'public/mult'</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> destinpath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span><span class="token string">'public/img'</span><span class="token punctuation">,</span>id<span class="token operator">+</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token string">'/img/'</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">'.jpg'</span>
  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>folderpath<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr2 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>folderpath<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> destinpath<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my_boke/zh-cn/nodes/js/02-JavaScript数组.html" class="prev">
        JavaScript数组
      </a></span> <span class="next"><a href="/my_boke/zh-cn/nodes/js/04-生成二维码.html">
        生成二维码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my_boke/assets/js/app.64921fdb.js" defer></script><script src="/my_boke/assets/js/2.1e45f81f.js" defer></script><script src="/my_boke/assets/js/14.1664cfab.js" defer></script>
  </body>
</html>
